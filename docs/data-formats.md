# Data Formats Documentation

**Project:** Blue Mountains Shale Mining Communities Digital Collection Software
**Purpose:** Specification of all data formats used in the project for interoperability
**Standards:** JSON (RFC 8259), CSV (RFC 4180), GeoJSON (RFC 7946)

---

## Overview

All data produced by this software uses standard, open formats to ensure interoperability, long-term accessibility, and compliance with FAIR data principles.

**Design Principles:**

1. **Human-Readable:** JSON and CSV formats are text-based and easy to inspect
2. **Machine-Parseable:** Conformant to published standards (RFC specifications)
3. **Self-Documenting:** Include metadata fields explaining data provenance
4. **Interoperable:** Compatible with common tools (Python, R, Excel, QGIS, jq)
5. **Versioned:** Schemas documented here; changes tracked in CHANGELOG.md

---

## File Formats Summary

| Format | Purpose | Standard | Tools | Scripts |
|--------|---------|----------|-------|---------|
| JSON | Structured data storage, API responses | RFC 8259 | Python `json`, `jq`, JavaScript | 01, 02, 03 |
| CSV | Tabular data, spreadsheet import | RFC 4180 | pandas, Excel, R, OpenRefine | 01, 02 |
| Markdown | Reports, documentation | CommonMark | Any text editor, Pandoc | 01, 02, 03 |
| PNG | Visualisations, charts | ISO/IEC 15948 | matplotlib, seaborn, image viewers | 02 |
| GeoJSON | Geographic data export | RFC 7946 | QGIS, GeoServer, Leaflet | Future |
| SKOS/RDF | Vocabulary publishing | W3C SKOS | rdflib, Protégé, RVA platform | Future (Phase 6) |

---

## JSON Data Schemas

### 1. raw_tags.json

**Purpose:** Complete export of all tags and associated items from Zotero group library

**Generated By:** `scripts/01_extract_tags.py`

**Use Cases:**
- Input for all subsequent tag analysis
- Backup of Zotero tag state at a specific point in time
- Audit trail for tag changes
- Research data archiving

**JSON Schema:**

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Zotero Tag Export",
  "type": "object",
  "required": ["metadata", "tags"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["generated_at", "zotero_group_id", "statistics"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of when this export was generated (UTC)",
          "example": "2025-10-09T10:30:00+11:00"
        },
        "zotero_group_id": {
          "type": "string",
          "description": "Zotero group library identifier",
          "example": "2258643"
        },
        "statistics": {
          "type": "object",
          "description": "Summary statistics about the library and tagging",
          "properties": {
            "total_items": {
              "type": "integer",
              "description": "Total number of top-level items in library",
              "example": 1189
            },
            "items_with_tags": {
              "type": "integer",
              "description": "Number of items that have at least one tag",
              "example": 336
            },
            "items_without_tags": {
              "type": "integer",
              "description": "Number of items with no tags",
              "example": 853
            },
            "unique_tags": {
              "type": "integer",
              "description": "Total number of distinct tags in use",
              "example": 481
            },
            "total_tag_applications": {
              "type": "integer",
              "description": "Total count of tag uses across all items (sum of all tag.count values)",
              "example": 892
            },
            "avg_tags_per_item": {
              "type": "number",
              "description": "Average number of tags per tagged item (total_tag_applications / items_with_tags)",
              "example": 2.65
            },
            "max_tags_per_item": {
              "type": "integer",
              "description": "Maximum number of tags on any single item",
              "example": 12
            },
            "min_tags_per_item": {
              "type": "integer",
              "description": "Minimum number of tags on tagged items (typically 1)",
              "example": 1
            }
          }
        }
      }
    },
    "tags": {
      "type": "object",
      "description": "Dictionary of tags, keyed by tag text",
      "patternProperties": {
        ".*": {
          "type": "object",
          "required": ["count", "items", "item_titles"],
          "properties": {
            "count": {
              "type": "integer",
              "description": "Number of items using this tag",
              "minimum": 1
            },
            "items": {
              "type": "array",
              "description": "Array of Zotero item keys (8-character alphanumeric IDs)",
              "items": {
                "type": "string",
                "pattern": "^[A-Z0-9]{8}$"
              },
              "uniqueItems": true
            },
            "item_titles": {
              "type": "array",
              "description": "Array of item titles (corresponding to items array by index)",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  }
}
```

**Example:**

```json
{
  "metadata": {
    "generated_at": "2025-10-09T10:30:00+11:00",
    "zotero_group_id": "2258643",
    "statistics": {
      "total_items": 1189,
      "items_with_tags": 336,
      "items_without_tags": 853,
      "unique_tags": 481,
      "total_tag_applications": 892,
      "avg_tags_per_item": 2.65,
      "max_tags_per_item": 12,
      "min_tags_per_item": 1
    }
  },
  "tags": {
    "Mining": {
      "count": 32,
      "items": ["ABC123XY", "DEF456UV"],
      "item_titles": [
        "The Ruined Castle Mines, Blue Mountains",
        "Shale Mining in the Jamison Valley, 1880-1914"
      ]
    },
    "Katoomba": {
      "count": 45,
      "items": ["GHI789WX"],
      "item_titles": [
        "Katoomba: Gateway to the Blue Mountains"
      ]
    }
  }
}
```

**Implementation Notes:**

- File encoding: UTF-8
- Indentation: 2 spaces (for readability)
- Tag names are case-sensitive as stored in Zotero
- Items and item_titles arrays maintain index correspondence
- ISO 8601 datetime format with timezone offset

---

### 2. tag_network.json

**Purpose:** Tag co-occurrence data for network analysis and visualisation

**Generated By:** `scripts/02_analyze_tags.py`

**Use Cases:**
- Network graph visualisation
- Identifying tag communities
- Understanding conceptual relationships
- Detecting tag clusters

**JSON Schema:**

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Tag Co-occurrence Network",
  "type": "object",
  "required": ["metadata", "cooccurrences"],
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "source_file": {
          "type": "string",
          "description": "Path to raw_tags.json file used as input"
        },
        "total_tag_pairs": {
          "type": "integer",
          "description": "Number of unique tag pairs (edges in network)"
        },
        "threshold": {
          "type": "integer",
          "description": "Minimum co-occurrence count to include pair",
          "default": 1
        }
      }
    },
    "cooccurrences": {
      "type": "array",
      "description": "Array of tag pairs that co-occur on the same items",
      "items": {
        "type": "object",
        "required": ["tag1", "tag2", "count"],
        "properties": {
          "tag1": {
            "type": "string",
            "description": "First tag in pair (alphabetically sorted)"
          },
          "tag2": {
            "type": "string",
            "description": "Second tag in pair (alphabetically sorted)"
          },
          "count": {
            "type": "integer",
            "description": "Number of items where both tags appear together",
            "minimum": 1
          },
          "items": {
            "type": "array",
            "description": "Optional: Zotero item keys where both tags appear",
            "items": {
              "type": "string"
            }
          },
          "jaccard_index": {
            "type": "number",
            "description": "Optional: Jaccard similarity coefficient (intersection/union)",
            "minimum": 0,
            "maximum": 1
          }
        }
      }
    }
  }
}
```

**Example:**

```json
{
  "metadata": {
    "generated_at": "2025-10-09T11:15:00+11:00",
    "source_file": "data/raw_tags.json",
    "total_tag_pairs": 1247,
    "threshold": 2
  },
  "cooccurrences": [
    {
      "tag1": "Katoomba",
      "tag2": "Mining",
      "count": 18,
      "items": ["ABC123XY", "DEF456UV", "..."],
      "jaccard_index": 0.42
    },
    {
      "tag1": "Jamison Valley",
      "tag2": "Ruined Castle",
      "count": 12,
      "items": ["GHI789WX", "..."],
      "jaccard_index": 0.63
    }
  ]
}
```

---

### 3. multiple_attachments_details.json

**Purpose:** Detailed information about Zotero items with multiple attachments for quality review

**Generated By:** `scripts/03_inspect_multiple_attachments.py`

**Use Cases:**
- Data quality assurance
- Identifying items that may need splitting
- Verifying attachment patterns
- Audit trail for data curation decisions

**JSON Schema:**

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Multiple Attachments Inspection Data",
  "type": "object",
  "required": ["generated_at", "zotero_group_id", "total_items", "items"],
  "properties": {
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "zotero_group_id": {
      "type": "string"
    },
    "total_items": {
      "type": "integer",
      "description": "Number of items inspected"
    },
    "items": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["key", "title", "itemType", "num_children", "children"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Zotero item key"
          },
          "title": {
            "type": "string"
          },
          "itemType": {
            "type": "string",
            "description": "Zotero item type (e.g., newspaperArticle, document)"
          },
          "date": {
            "type": "string",
            "description": "Publication date"
          },
          "publicationTitle": {
            "type": "string"
          },
          "pages": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "num_children": {
            "type": "integer",
            "description": "Number of child items (attachments + notes)"
          },
          "children": {
            "type": "array",
            "description": "Array of child attachments and notes",
            "items": {
              "type": "object",
              "properties": {
                "key": {
                  "type": "string"
                },
                "itemType": {
                  "type": "string",
                  "enum": ["attachment", "note"]
                },
                "title": {
                  "type": "string"
                },
                "filename": {
                  "type": "string",
                  "description": "Filename for attachments"
                },
                "contentType": {
                  "type": "string",
                  "description": "MIME type (e.g., application/pdf)"
                },
                "linkMode": {
                  "type": "string",
                  "description": "Attachment link mode (imported_file, linked_file, etc.)"
                },
                "note": {
                  "type": "string",
                  "description": "Note content (HTML) if itemType is 'note'"
                }
              }
            }
          },
          "category": {
            "type": "string",
            "enum": ["multiple_pdfs", "pdf_plus_notes", "multiple_notes", "mixed_content", "uncertain"],
            "description": "Categorisation of attachment pattern"
          },
          "reasoning": {
            "type": "string",
            "description": "Explanation of categorisation"
          },
          "action": {
            "type": "string",
            "description": "Recommended action (e.g., 'REVIEW', 'HIGH PRIORITY')"
          }
        }
      }
    }
  }
}
```

---

## CSV Data Schemas

### 1. tag_frequency.csv

**Purpose:** Tag usage statistics sorted by frequency

**Generated By:** `scripts/01_extract_tags.py`

**Columns:**

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `tag` | string | Tag text (case-sensitive) | "Mining" |
| `count` | integer | Number of items using this tag | 32 |
| `percentage` | float | Percentage of all tagged items | 9.52 |

**Sorting:** Descending by `count`

**Example:**

```csv
tag,count,percentage
Mining,32,9.52
Katoomba,45,13.39
Court,45,13.39
Jamison Valley,12,3.57
Accident,8,2.38
```

**Implementation Notes:**

- Header row always present
- UTF-8 encoding
- Comma delimiter (RFC 4180)
- Quoted fields if containing commas or newlines
- Percentage to 2 decimal places

---

### 2. similar_tags.csv

**Purpose:** Pairs of similar tags for consolidation review

**Generated By:** `scripts/02_analyze_tags.py`

**Columns:**

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `tag1` | string | First tag | "Court" |
| `tag2` | string | Second tag | "Court cases" |
| `count1` | integer | Usage count of tag1 | 45 |
| `count2` | integer | Usage count of tag2 | 45 |
| `similarity` | float | Similarity score (0-100) | 100.0 |
| `suggested_merge` | string | Recommended consolidation target | "Court" |

**Sorting:** Descending by `similarity`, then by `count1`

**Example:**

```csv
tag1,tag2,count1,count2,similarity,suggested_merge
Court,Court cases,45,45,100.0,Court
Katoomba,Katoomba NSW,45,12,85.7,Katoomba
Mining,Mine,32,8,83.3,Mining
```

**Algorithm:** Uses fuzzywuzzy library with Levenshtein Distance
**Threshold:** Default 80% similarity

---

### 3. quality_*.csv Files

**Purpose:** Data quality issue lists for curation

**Generated By:** `scripts/02_analyze_tags.py`

**Files:**
- `quality_duplicates.csv`: Potential duplicate items
- `quality_non_primary_sources.csv`: Items flagged as not primary sources
- `quality_multiple_attachments.csv`: Items with multiple attachments
- `quality_no_attachments.csv`: Items missing expected attachments

**Common Columns:**

| Column | Type | Description |
|--------|------|-------------|
| `key` | string | Zotero item key |
| `title` | string | Item title |
| `itemType` | string | Zotero item type |
| `date` | string | Publication date |
| `publicationTitle` | string | Source publication |
| `tags` | string | Comma-separated list of tags |
| `issue` | string | Description of quality issue |

**Example:**

```csv
key,title,itemType,date,publicationTitle,tags,issue
ABC123XY,"Mining Report",document,1895-06-12,"Sydney Morning Herald","Mining, Katoomba",Possible duplicate of DEF456UV
```

---

## Markdown Report Formats

### Reports Structure

All Markdown reports follow this template:

```markdown
# Report Title

**Generated:** YYYY-MM-DD HH:MM:SS
**Zotero Group ID:** 2258643

---

## Overview

[Summary statistics and purpose]

---

## Section 1

[Analysis results]

---

## Next Steps

[Recommended actions]

---

*Generated by Blue Mountains Digital Collection Project - Phase 1*
```

**Compliance:** CommonMark specification with GitHub Flavoured Markdown extensions

**Linting Rules:** MD022, MD031, MD032, MD040 (as per CLAUDE.md)

---

## PNG Visualisation Formats

### Generated Charts

**Scripts:** `scripts/02_analyze_tags.py`

**Files:**
- `visualisations/tag_frequency_top20.png`: Bar chart of top 20 most-used tags
- `visualisations/tag_network.png`: Network graph of tag co-occurrences
- `visualisations/tag_similarity_heatmap.png`: Heatmap of tag similarities

**Specifications:**
- Format: PNG (Portable Network Graphics)
- Resolution: 300 DPI (publication quality)
- Size: 1920x1080 pixels (default)
- Colour space: RGB
- Libraries: matplotlib 3.0+, seaborn 0.12+

---

## Future Formats (Planned)

### GeoJSON Export

**Purpose:** Geographic data for mapping applications

**Use Cases:**
- QGIS mapping
- Web map integration (Leaflet, Mapbox)
- Spatial analysis

**Specification:** RFC 7946

**Example:**

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [150.3667, -33.7333]
      },
      "properties": {
        "name": "Jamison Valley",
        "feature_type": "VALLEY",
        "authority": "NSW",
        "nat_id": "NSW_12345",
        "gazetteer_source": "Composite Gazetteer of Australia"
      }
    }
  ]
}
```

**Implementation:** Phase 3 (Location Data Enhancement)

---

### SKOS/RDF Vocabulary

**Purpose:** Publishing controlled vocabulary to Research Vocabularies Australia

**Format:** SKOS (Simple Knowledge Organisation System) in RDF/XML or Turtle

**Use Cases:**
- RVA publishing
- Vocabulary reuse by other projects
- Semantic web integration

**Example (Turtle format):**

```turtle
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

<http://bluemountains.example.org/vocab/mining>
  a skos:Concept ;
  skos:prefLabel "Mining"@en ;
  skos:altLabel "Mine"@en ;
  skos:definition "Activities related to extracting shale ore from the earth"@en ;
  skos:broader <http://vocab.getty.edu/aat/300053857> ;
  dcterms:created "2025-10-09"^^xsd:date .
```

**Implementation:** Phase 6 (RVA Publishing)

---

## Data Interchange Guidelines

### Exporting Data

**From Python:**

```python
import json
import pandas as pd

# Export JSON
with open('output.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)

# Export CSV
df.to_csv('output.csv', index=False, encoding='utf-8')
```

**Validation:**

```bash
# Validate JSON
cat data.json | jq . > /dev/null && echo "Valid JSON"

# Check CSV structure
csvstat data/tag_frequency.csv
```

### Importing Data

**Into R:**

```r
library(jsonlite)
library(readr)

# Import JSON
tags <- fromJSON("data/raw_tags.json")

# Import CSV
frequency <- read_csv("data/tag_frequency.csv")
```

**Into OpenRefine:**

1. Create Project → Choose Files → Upload CSV
2. Configure parsing options (UTF-8, comma delimiter)
3. Apply transformations for data cleaning
4. Export cleaned data

---

## Data Provenance

All data files include provenance metadata:

1. **Generation Timestamp:** ISO 8601 datetime with timezone
2. **Source Identification:** Zotero Group ID, source file paths
3. **Software Version:** Tracked in CHANGELOG.md
4. **Processing Parameters:** Thresholds, filters, algorithms used

**Example Provenance Block:**

```json
"metadata": {
  "generated_at": "2025-10-09T10:30:00+11:00",
  "software_version": "0.1.0",
  "zotero_group_id": "2258643",
  "source_file": "data/raw_tags.json",
  "processing": {
    "similarity_threshold": 80,
    "algorithm": "fuzzywuzzy.fuzz.ratio",
    "min_tag_count": 1
  }
}
```

---

## File Naming Conventions

**JSON Files:**
- `raw_*.json`: Unprocessed data from APIs
- `*_network.json`: Network/graph data
- `*_details.json`: Detailed item information

**CSV Files:**
- `tag_*.csv`: Tag-related tabular data
- `quality_*.csv`: Data quality issue lists
- `*_summary.csv`: Summary statistics

**Reports:**
- `*_summary.md`: Overview reports
- `*_analysis.md`: Detailed analysis reports
- `*_inspection.md`: Quality review reports

**Images:**
- `*_top20.png`: Top 20 frequency charts
- `*_network.png`: Network visualisations
- `*_heatmap.png`: Similarity heatmaps

**Conventions:**
- All lowercase
- Underscores for word separation (snake_case)
- Descriptive, not abbreviated
- Dates in ISO 8601 format (YYYY-MM-DD) when included in filenames

---

## References

- **JSON:** [RFC 8259](https://tools.ietf.org/html/rfc8259)
- **CSV:** [RFC 4180](https://tools.ietf.org/html/rfc4180)
- **GeoJSON:** [RFC 7946](https://tools.ietf.org/html/rfc7946)
- **SKOS:** [W3C SKOS Reference](https://www.w3.org/TR/skos-reference/)
- **ISO 8601:** [Date and Time Format](https://en.wikipedia.org/wiki/ISO_8601)
- **JSON Schema:** [https://json-schema.org/](https://json-schema.org/)

---

*Blue Mountains Shale Mining Communities Digital Collection Software*
*ARC Linkage Project LP190100900*
